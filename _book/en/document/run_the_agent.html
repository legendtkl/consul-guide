
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>1.4.2 Run the Agent Â· consul guide and inside</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-emphasize/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="services.html" />
    
    
    <link rel="prev" href="install_consul.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    1. Documentation Home
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="whatisconsul.html">
            
                <a href="whatisconsul.html">
            
                    
                    1.1 What is consul
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="comparison.html">
            
                <a href="comparison.html">
            
                    
                    1.2 Consul vs. Other Software
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="zookeeper.html">
            
                <a href="zookeeper.html">
            
                    
                    1.2.1 ZooKeeper,doozerd,etcd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="chef.html">
            
                <a href="chef.html">
            
                    
                    1.2.2 Chef,Puppet,etc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="nagios.html">
            
                <a href="nagios.html">
            
                    
                    1.2.3 Nagios,Sensu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="skyDNS.html">
            
                <a href="skyDNS.html">
            
                    
                    1.2.4 SkyDNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="smartstack.html">
            
                <a href="smartstack.html">
            
                    
                    1.2.5 SmartStack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="serf.html">
            
                <a href="serf.html">
            
                    
                    1.2.6 Serf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.7" data-path="custom_solutions.html">
            
                <a href="custom_solutions.html">
            
                    
                    1.2.7 Custom Solutions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="hashicorp_ecosystem.html">
            
                <a href="hashicorp_ecosystem.html">
            
                    
                    1.3 Consul & The Hashicorp Ecosystem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="getting_started.html">
            
                <a href="getting_started.html">
            
                    
                    1.4 Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="install_consul.html">
            
                <a href="install_consul.html">
            
                    
                    1.4.1 Install Consul
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.4.2" data-path="run_the_agent.html">
            
                <a href="run_the_agent.html">
            
                    
                    1.4.2 Run the Agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="services.html">
            
                <a href="services.html">
            
                    
                    1.4.3 Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="consul_cluster.html">
            
                <a href="consul_cluster.html">
            
                    
                    1.4.4 Consul Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="health_checks.html">
            
                <a href="health_checks.html">
            
                    
                    1.4.5 Health Checks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.6" data-path="key_value_data.html">
            
                <a href="key_value_data.html">
            
                    
                    1.4.6 Key/Value Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.7" data-path="web_ui.html">
            
                <a href="web_ui.html">
            
                    
                    1.4.7 Web UI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.8" data-path="next_steps.html">
            
                <a href="next_steps.html">
            
                    
                    1.4.8 Next Steps
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../upgrade/">
            
                <a href="../upgrade/">
            
                    
                    2. Upgrading and Compatibility
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../upgrade/upgrading_consul.html">
            
                <a href="../upgrade/upgrading_consul.html">
            
                    
                    2.1 Upgrading Consul
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../upgrade/compatibility_promise.html">
            
                <a href="../upgrade/compatibility_promise.html">
            
                    
                    2.2 Compatibility Promise
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../upgrade/specific_version.html">
            
                <a href="../upgrade/specific_version.html">
            
                    
                    2.3 Specific Version Details
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../internal/">
            
                <a href="../internal/">
            
                    
                    3. Consul Internals
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../internal/architecture.html">
            
                <a href="../internal/architecture.html">
            
                    
                    3.1 Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../internal/consensus_protocal.html">
            
                <a href="../internal/consensus_protocal.html">
            
                    
                    3.2 Consensus Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../internal/gossip_protocal.html">
            
                <a href="../internal/gossip_protocal.html">
            
                    
                    3.3 Gossip Protocal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../internal/network_coordinates.html">
            
                <a href="../internal/network_coordinates.html">
            
                    
                    3.4 Network Coordinates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../internal/sessions.html">
            
                <a href="../internal/sessions.html">
            
                    
                    3.5 Sessions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../internal/acls.html">
            
                <a href="../internal/acls.html">
            
                    
                    3.6 ACLs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../internal/anti_entropy.html">
            
                <a href="../internal/anti_entropy.html">
            
                    
                    3.7 Anti-Entropy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../internal/security_model.html">
            
                <a href="../internal/security_model.html">
            
                    
                    3.8 Security Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../internal/jepsen_testing.html">
            
                <a href="../internal/jepsen_testing.html">
            
                    
                    3.9 Jepsen Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../commands/">
            
                <a href="../commands/">
            
                    
                    4. Consul Commands(CLI)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../commands/agent.html">
            
                <a href="../commands/agent.html">
            
                    
                    4.1 agent
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../commands/configtest.html">
            
                <a href="../commands/configtest.html">
            
                    
                    4.2 configtest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../commands/event.html">
            
                <a href="../commands/event.html">
            
                    
                    4.3 event
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../commands/exec.html">
            
                <a href="../commands/exec.html">
            
                    
                    4.4 exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../commands/force_leave.html">
            
                <a href="../commands/force_leave.html">
            
                    
                    4.5 force-leave
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../commands/join.html">
            
                <a href="../commands/join.html">
            
                    
                    4.6 join
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../commands/keygen.html">
            
                <a href="../commands/keygen.html">
            
                    
                    4.7 keygen
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../commands/keyring.html">
            
                <a href="../commands/keyring.html">
            
                    
                    4.8 keyring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../commands/kv.html">
            
                <a href="../commands/kv.html">
            
                    
                    4.9 kv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../commands/leave.html">
            
                <a href="../commands/leave.html">
            
                    
                    4.10 leave
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../commands/lock.html">
            
                <a href="../commands/lock.html">
            
                    
                    4.11 lock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../commands/maint.html">
            
                <a href="../commands/maint.html">
            
                    
                    4.12 maint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../commands/members.html">
            
                <a href="../commands/members.html">
            
                    
                    4.13 members
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../commands/monitor.html">
            
                <a href="../commands/monitor.html">
            
                    
                    4.14 monitor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15" data-path="../commands/operator.html">
            
                <a href="../commands/operator.html">
            
                    
                    4.15 operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.16" data-path="../commands/info.html">
            
                <a href="../commands/info.html">
            
                    
                    4.16 info
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17" data-path="../commands/reload.html">
            
                <a href="../commands/reload.html">
            
                    
                    4.17 reload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.18" data-path="../commands/rtt.html">
            
                <a href="../commands/rtt.html">
            
                    
                    4.18 rtt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.19" data-path="../commands/snapshot.html">
            
                <a href="../commands/snapshot.html">
            
                    
                    4.19 snapshot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20" data-path="../commands/watch.html">
            
                <a href="../commands/watch.html">
            
                    
                    4.20 watch
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../agent/">
            
                <a href="../agent/">
            
                    
                    5. Consul Agent
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../agent/running_and_stopping.html">
            
                <a href="../agent/running_and_stopping.html">
            
                    
                    5.1 Running and Stopping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../agent/dns_interface.html">
            
                <a href="../agent/dns_interface.html">
            
                    
                    5.2 DNS Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../agent/http_api.html">
            
                <a href="../agent/http_api.html">
            
                    
                    5.3 HTTP API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../agent/configuration.html">
            
                <a href="../agent/configuration.html">
            
                    
                    5.4 Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../agent/service_definitions.html">
            
                <a href="../agent/service_definitions.html">
            
                    
                    5.5 Service Definitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../agent/check_definitions.html">
            
                <a href="../agent/check_definitions.html">
            
                    
                    5.6 Check Definitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../agent/encryption.html">
            
                <a href="../agent/encryption.html">
            
                    
                    5.7 Encryption
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../agent/rpc_protocol.html">
            
                <a href="../agent/rpc_protocol.html">
            
                    
                    5.8 RPC Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../agent/telemetry.html">
            
                <a href="../agent/telemetry.html">
            
                    
                    5.9 Telemetry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../agent/watches.html">
            
                <a href="../agent/watches.html">
            
                    
                    5.10 Watches
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../guides/">
            
                <a href="../guides/">
            
                    
                    6. Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../guides/atlas_integration.html">
            
                <a href="../guides/atlas_integration.html">
            
                    
                    6.1 Atlas Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../guides/add_remove_servers.html">
            
                <a href="../guides/add_remove_servers.html">
            
                    
                    6.2 Adding/Removing Servers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../guides/bootstrapping.html">
            
                <a href="../guides/bootstrapping.html">
            
                    
                    6.3 Bootstrapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../guides/dns_forwarding.html">
            
                <a href="../guides/dns_forwarding.html">
            
                    
                    6.4 DNS Forwarding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../guides/external_services.html">
            
                <a href="../guides/external_services.html">
            
                    
                    6.5 External Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../guides/leader_election.html">
            
                <a href="../guides/leader_election.html">
            
                    
                    6.6 Leader Election
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../guides/multiple_datacenters.html">
            
                <a href="../guides/multiple_datacenters.html">
            
                    
                    6.7 Multiple Datacenters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../guides/outage_recovery.html">
            
                <a href="../guides/outage_recovery.html">
            
                    
                    6.8 Outage Recovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../guides/semaphore.html">
            
                <a href="../guides/semaphore.html">
            
                    
                    6.9 Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../guides/server_performance.html">
            
                <a href="../guides/server_performance.html">
            
                    
                    6.10 Server Performance
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../QA/">
            
                <a href="../QA/">
            
                    
                    7. Frequently Asked Questions
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >1.4.2 Run the Agent</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="run-the-consul-agent">Run the Consul Agent</h1>
<p>After Consul is installed, the agent must be run. The agent can run either in server or client mode. Each datacenter must have at least one server, though a cluster of 3 or 5 servers is recommended. A single server deployment is <strong><em>highly</em></strong> discouraged as data loss is inevitable in a failure scenario.</p>
<p>All other agents run in client mode. A client is a very lightweight process that registers services, runs health checks, and forwards queries to servers. The agent must be run on every node that is part of the cluster.</p>
<p>For more detail on bootstrapping a datacenter, see <a href="../guides/bootstrapping.html">this guide</a>.</p>
<h2 id="starting-the-agent">Starting the Agent</h2>
<p>For simplicity, we&apos;ll start the Consul agent in development mode for now. This mode is useful for bringing up a single-node Consul environment quickly and easily. It is <strong>not</strong> intended to be used in production as it does not persist any state.</p>
<pre class="language-"><code class="lang-bash">-$ consul agent -dev
<span class="token operator">==</span><span class="token operator">&gt;</span> Starting Consul agent<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">&gt;</span> Starting Consul agent RPC<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">&gt;</span> Consul agent running<span class="token operator">!</span>
           Version: <span class="token string">&apos;v0.7.0&apos;</span>
         Node name: <span class="token string">&apos;Armons-MacBook-Air&apos;</span>
        Datacenter: <span class="token string">&apos;dc1&apos;</span>
            Server: <span class="token boolean">true</span> <span class="token punctuation">(</span>bootstrap: false<span class="token punctuation">)</span>
       Client Addr: 127.0.0.1 <span class="token punctuation">(</span>HTTP: 8500, HTTPS: -1, DNS: 8600, RPC: 8400<span class="token punctuation">)</span>
      Cluster Addr: 127.0.0.1 <span class="token punctuation">(</span>LAN: 8301, WAN: 8302<span class="token punctuation">)</span>
    Gossip encrypt: false, RPC-TLS: false, TLS-Incoming: <span class="token boolean">false</span>
             Atlas: <span class="token operator">&lt;</span>disabled<span class="token operator">&gt;</span>

<span class="token operator">==</span><span class="token operator">&gt;</span> Log data will now stream <span class="token keyword">in</span> as it occurs:

    2016/09/15 10:21:10 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> raft: Initial configuration <span class="token punctuation">(</span>index<span class="token operator">=</span>1<span class="token punctuation">)</span>: <span class="token punctuation">[</span><span class="token punctuation">{</span>Suffrage:Voter ID:127.0.0.1:8300 Address:127.0.0.1:8300<span class="token punctuation">}</span><span class="token punctuation">]</span>
    2016/09/15 10:21:10 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> raft: Node at 127.0.0.1:8300 <span class="token punctuation">[</span>Follower<span class="token punctuation">]</span> entering Follower state <span class="token punctuation">(</span>Leader: <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    2016/09/15 10:21:10 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> serf: EventMemberJoin: Armons-MacBook-Air 127.0.0.1
    2016/09/15 10:21:10 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> serf: EventMemberJoin: Armons-MacBook-Air.dc1 127.0.0.1
    2016/09/15 10:21:10 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> consul: Adding LAN server Armons-MacBook-Air <span class="token punctuation">(</span>Addr: tcp/127.0.0.1:8300<span class="token punctuation">)</span> <span class="token punctuation">(</span>DC: dc1<span class="token punctuation">)</span>
    2016/09/15 10:21:10 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> consul: Adding WAN server Armons-MacBook-Air.dc1 <span class="token punctuation">(</span>Addr: tcp/127.0.0.1:8300<span class="token punctuation">)</span> <span class="token punctuation">(</span>DC: dc1<span class="token punctuation">)</span>
    2016/09/15 10:21:13 <span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> http: Request GET /v1/agent/services <span class="token punctuation">(</span>180.708&#xB5;s<span class="token punctuation">)</span> from<span class="token operator">=</span>127.0.0.1:52369
    2016/09/15 10:21:13 <span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> http: Request GET /v1/agent/services <span class="token punctuation">(</span>15.548&#xB5;s<span class="token punctuation">)</span> from<span class="token operator">=</span>127.0.0.1:52369
    2016/09/15 10:21:17 <span class="token punctuation">[</span>WARN<span class="token punctuation">]</span> raft: Heartbeat <span class="token function">timeout</span> from <span class="token string">&quot;&quot;</span> reached, starting election
    2016/09/15 10:21:17 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> raft: Node at 127.0.0.1:8300 <span class="token punctuation">[</span>Candidate<span class="token punctuation">]</span> entering Candidate state <span class="token keyword">in</span> term 2
    2016/09/15 10:21:17 <span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> raft: Votes needed: 1
    2016/09/15 10:21:17 <span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> raft: Vote granted from 127.0.0.1:8300 <span class="token keyword">in</span> term 2. Tally: 1
    2016/09/15 10:21:17 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> raft: Election won. Tally: 1
    2016/09/15 10:21:17 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> raft: Node at 127.0.0.1:8300 <span class="token punctuation">[</span>Leader<span class="token punctuation">]</span> entering Leader state
    2016/09/15 10:21:17 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> consul: cluster leadership acquired
    2016/09/15 10:21:17 <span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> consul: reset tombstone GC to index 3
    2016/09/15 10:21:17 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> consul: New leader elected: Armons-MacBook-Air
    2016/09/15 10:21:17 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> consul: member <span class="token string">&apos;Armons-MacBook-Air&apos;</span> joined, marking health alive
    2016/09/15 10:21:17 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> agent: Synced <span class="token function">service</span> <span class="token string">&apos;consul&apos;</span>
</code></pre>
<p>As you can see, the Consul agent has started and has output some log data. From the log data, you can see that our agent is running in server mode and has claimed leadership of the cluster. Additionally, the local member has been marked as a healthy member of the cluster.</p>
<p><span class="pg-emphasize pg-emphasize-yellow" style=""><strong>Note for OS X Users</strong>: Consul uses your hostname as the default node name. If your hostname contains periods, DNS queries to that node will not work with Consul. To avoid this, explicitly set the name of your node with the <code>-node</code> flag.</span></p>
<h2 id="cluster-members">Cluster Members</h2>
<p>If you run <code>consul members</code> in another terminal, you can see the members of the Consul cluster. We&apos;ll cover joining clusters in the next section, but for now, you should only see one member (yourself):</p>
<pre class="language-"><code class="lang-bash">$ consul members
Node                Address            Status  Type    Build     Protocol  DC
Armons-MacBook-Air  172.20.20.11:8301  alive   server  0.6.1dev  2         dc1
</code></pre>
<p>The output shows our own node, the address it is running on, its health state, its role in the cluster, and some version information. Additional metadata can be viewed by providing the <code>-detailed</code> flag.</p>
<p>The output of the <code>members</code> command is based on the gossip protocol and is eventually consistent. That is, at any point in time, the view of the world as seen by your local agent may not exactly match the state on the servers. For a strongly consistent view of the world, use the HTTP API as it forwards the request to the Consul servers:</p>
<pre class="language-"><code class="lang-bash">$ curl localhost:8500/v1/catalog/nodes
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;Node&quot;</span><span class="token keyword">:</span><span class="token string">&quot;Armons-MacBook-Air&quot;</span>,<span class="token string">&quot;Address&quot;</span><span class="token keyword">:</span><span class="token string">&quot;127.0.0.1&quot;</span>,<span class="token string">&quot;TaggedAddresses&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;lan&quot;</span><span class="token keyword">:</span><span class="token string">&quot;127.0.0.1&quot;</span>,<span class="token string">&quot;wan&quot;</span><span class="token keyword">:</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;CreateIndex&quot;</span>:4,<span class="token string">&quot;ModifyIndex&quot;</span>:110<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre>
<p>In addition to the HTTP API, the DNS interface can be used to query the node. Note that you have to make sure to point your DNS lookups to the Consul agent&apos;s DNS server which runs on port 8600 by default. The format of the DNS entries (such as &quot;Armons-MacBook-Air.node.consul&quot;) will be covered in more detail later.</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">dig</span> @127.0.0.1 -p 8600 Armons-MacBook-Air.node.consul
<span class="token punctuation">..</span>.

<span class="token punctuation">;</span><span class="token punctuation">;</span> QUESTION SECTION:
<span class="token punctuation">;</span>Armons-MacBook-Air.node.consul.    IN  A

<span class="token punctuation">;</span><span class="token punctuation">;</span> ANSWER SECTION:
Armons-MacBook-Air.node.consul. 0 IN    A   127.0.0.1
</code></pre>
<h2 id="stopping-the-agent">Stopping the Agent</h2>
<p>You can use Ctrl-C (the interrupt signal) to gracefully halt the agent. After interrupting the agent, you should see it leave the cluster and shut down.</p>
<p>By gracefully leaving, Consul notifies other cluster members that the node left. If you had forcibly killed the agent process, other members of the cluster would have detected that the node failed. When a member leaves, its services and checks are removed from the catalog. When a member fails, its health is simply marked as critical, but it is not removed from the catalog. Consul will automatically try to reconnect to failed nodes, allowing it to recover from certain network conditions, while left nodes are no longer contacted.</p>
<p>Additionally, if an agent is operating as a server, a graceful leave is important to avoid causing a potential availability outage affecting the consensus protocol. See the guides section for details on how to safely add and remove servers.</p>
<h2 id="next-steps">Next Steps</h2>
<p>Your simple Consul cluster is up and running. Let&apos;s give it some services!</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="install_consul.html" class="navigation navigation-prev " aria-label="Previous page: 1.4.1 Install Consul">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="services.html" class="navigation navigation-next " aria-label="Next page: 1.4.3 Services">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"1.4.2 Run the Agent","level":"1.2.4.2","depth":3,"next":{"title":"1.4.3 Services","level":"1.2.4.3","depth":3,"path":"document/services.md","ref":"document/services.md","articles":[]},"previous":{"title":"1.4.1 Install Consul","level":"1.2.4.1","depth":3,"path":"document/install_consul.md","ref":"document/install_consul.md","articles":[]},"dir":"ltr"},"config":{"plugins":["toggle-chapters","splitter","prism","-highlight","emphasize"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"emphasize":{},"livereload":{},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"toggle-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"consul guide and inside","language":"en","gitbook":"*","description":"consul is an awesome sofeware for service discovery"},"file":{"path":"document/run_the_agent.md","mtime":"2016-12-27T15:30:54.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2016-12-28T14:03:46.369Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

